<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Omelette</title>
  <link rel="icon" href="https://cdn-icons-png.freepik.com/256/7219/7219516.png?semt=ais_white_label">

  <style>
    @font-face{
      font-family:"Alphabetized Cassette Tapes";
      src:url("./Alphabetized Cassette Tapes.ttf") format("truetype");
    }

    :root{
      --bg:#F7DD80;
      --text:#000;

      --fs-title: clamp(56px, 5.6vw, 88px);
      --fs-subtitle: clamp(34px, 3.2vw, 50px);
      --fs-goal: clamp(20px, 2vw, 30px);

      --egg-w: min(80vw, 640px);
      --egg-gap: -40px;

      --ease: cubic-bezier(.2,.8,.2,1);
      --t-move: 560ms;
      --t-fade: 420ms;
    }

    html,body{
      height:100%;
      margin:0;
      background:var(--bg);
      overflow:hidden;
      font-family:"Alphabetized Cassette Tapes",system-ui,sans-serif;
      color:var(--text);
    }

    #app{
      width:100vw;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .stage{
      position:relative;
      width:100%;
      height:100%;
      max-width:1400px;
    }

    /* ---------- SHARED TEXT ---------- */
    #sharedLayer{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:50;
    }

    #breakText{
      position:absolute;
      left:50%;
      transform:translate(-50%,0);
      font-size:var(--fs-title);
      white-space:nowrap;
      transition:transform var(--t-move) var(--ease), opacity var(--t-fade);
    }

    .breakAnchor{ height:var(--break-h,0px); }

    /* ---------- INTRO ---------- */
    #introScene{
      position:absolute;
      inset:0;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      transition:transform var(--t-move) var(--ease), opacity var(--t-fade);
    }

    #topText{
      font-size:var(--fs-title);
      margin:0 0 var(--egg-gap);
      text-align:center;
    }

    #eggHolder{ width:var(--egg-w); }
    #eggHolder svg{ width:100%; display:block; }

    #introBreakAnchor{ margin-top:var(--egg-gap); }

    /* ---------- GOALS ---------- */
    #goalsScene{
      position:absolute;
      inset:0;
      opacity:0;
      pointer-events:none;
      transform:translateY(80px);
      transition:transform var(--t-move) var(--ease), opacity var(--t-fade);
      display:flex;
      flex-direction:column;
    }

    #goalsBody{
      flex:1;
      display:flex;
      justify-content:center;   /* horizontal */
      align-items:center;       /* âœ… vertical centering */
      overflow-y:auto;
      padding:16px;
    }

    #goalsPanel{
      width:min(96vw,1200px);
      display:flex;
      flex-direction:column;
      gap:14px;
      align-items:center;
    }

    .section{ width:100%; text-align:center; }
    .subtitle{ font-size:var(--fs-subtitle); }

    .goalsRow{
      display:flex;
      gap:12px;
      overflow-x:auto;
      justify-content:center;
    }

    .goal{ min-width:110px; }
    .goalLabel{ font-size:var(--fs-goal); white-space:nowrap; }

    .bar{
      width:30px;
      height:3px;
      border:2px solid #000;
      border-radius:999px;
      margin:6px auto 0;
      overflow:hidden;
      background:#fff;
    }

    .fill{
      height:100%;
      background:#000;
      width:calc(var(--pct,0) * 1%);
    }

    /* ---------- MODES ---------- */
    body.mode-goals #introScene{
      opacity:0;
      transform:translateY(-90px);
      pointer-events:none;
    }

    body.mode-goals #goalsScene{
      opacity:1;
      transform:none;
      pointer-events:auto;
    }
  </style>
</head>

<body>
<div id="app">
  <div class="stage">
    <div id="sharedLayer">
      <div id="breakText">you gotta break some eggs</div>
    </div>

    <div id="introScene">
      <div id="topText">you wanna make an omelette</div>
      <div id="eggHolder"></div>
      <div id="introBreakAnchor" class="breakAnchor"></div>
    </div>

    <div id="goalsScene">
      <div id="goalsBreakAnchor" class="breakAnchor"></div>
      <div id="goalsBody">
        <div id="goalsPanel"></div>
      </div>
    </div>
  </div>
</div>

<script type="module">
  import { EGG_ART } from "./egg-art.js";

  /* ---------- EGG (FULL FACE) ---------- */
  document.getElementById("eggHolder").innerHTML = `
    <svg viewBox="0 0 1080 1080">
      <g>
        <path d="${EGG_ART.whitePath}" fill="#F7FCF6" stroke="#000" stroke-width="12"/>
        <circle cx="${EGG_ART.yolk.cx}" cy="${EGG_ART.yolk.cy}" r="${EGG_ART.yolk.r}"
                fill="#F5C966" stroke="#000" stroke-width="12"/>
        <ellipse cx="${EGG_ART.eyeL.cx}" cy="${EGG_ART.eyeL.cy}"
                 rx="${EGG_ART.eyeL.rx}" ry="${EGG_ART.eyeL.ry}" fill="#000"/>
        <ellipse cx="${EGG_ART.eyeR.cx}" cy="${EGG_ART.eyeR.cy}"
                 rx="${EGG_ART.eyeR.rx}" ry="${EGG_ART.eyeR.ry}" fill="#000"/>
        <path d="${EGG_ART.mouthPath}" fill="none" stroke="#000"
              stroke-width="7" stroke-linecap="round"/>
      </g>
    </svg>
  `;

  /* ---------- GOALS DATA ---------- */
  async function loadGoals(){
    const res = await fetch("./goals-data.json",{cache:"no-store"});
    return res.json();
  }

  function renderGoals({sections,progress}){
    const panel=document.getElementById("goalsPanel");
    panel.innerHTML=sections.map(sec=>`
      <div class="section">
        <div class="subtitle">${sec.subtitle}</div>
        <div class="goalsRow">
          ${sec.goals.map(g=>{
            const pct=Math.max(0,Math.min(100,progress[g]||0));
            return `
              <div class="goal">
                <div class="goalLabel">${g}</div>
                <div class="bar"><div class="fill" style="--pct:${pct}"></div></div>
              </div>`;
          }).join("")}
        </div>
      </div>
    `).join("");
  }

  loadGoals().then(renderGoals);

  /* ---------- BREAK TEXT LOCK ---------- */
  const app=document.getElementById("app");
  const breakText=document.getElementById("breakText");
  const introAnchor=document.getElementById("introBreakAnchor");
  const goalsAnchor=document.getElementById("goalsBreakAnchor");

  let goalsMode=false;
  let cachedIntroY=null;

  function syncBreakHeight(){
    document.documentElement.style.setProperty(
      "--break-h",
      breakText.getBoundingClientRect().height+"px"
    );
  }

  function calcY(anchor){
    const a=anchor.getBoundingClientRect();
    const b=breakText.getBoundingClientRect();
    const appRect=app.getBoundingClientRect();
    return (a.top-appRect.top)+(a.height-b.height)/2;
  }

  function placeBreak(animate){
    const y=!goalsMode
      ? (cachedIntroY ??= calcY(introAnchor))
      : calcY(goalsAnchor);

    if(!animate){
      breakText.style.transition="none";
      breakText.style.transform=`translate(-50%,${y}px)`;
      requestAnimationFrame(()=>breakText.style.transition="");
    }else{
      breakText.style.transform=`translate(-50%,${y}px)`;
    }
  }

  function layout(animate=false){
    syncBreakHeight();
    placeBreak(animate);
  }

  requestAnimationFrame(()=>requestAnimationFrame(()=>layout(false)));
  window.addEventListener("resize",()=>layout(false));

  window.addEventListener("keydown",e=>{
    if(e.key==="ArrowDown"){
      goalsMode=true;
      document.body.classList.add("mode-goals");
      layout(true);
    }
    if(e.key==="ArrowUp"){
      goalsMode=false;
      document.body.classList.remove("mode-goals");
      layout(true);
    }
  });
</script>
</body>
</html>
